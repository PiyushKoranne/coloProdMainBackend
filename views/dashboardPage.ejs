

<div class="dashboard-pg-wr">
	<h1 style="font-size: 22px;">Dashboard</h1>
	<div class="msg-container" style="width: 100%;">
		<% message?.forEach(msgItem =>{ %>
			<div class="msg" style="background-color: <%= msgItem?.success ? '#fff':'#FFB0B03f' %>;">
				<p style="text-transform:capitalize;display: flex;align-items: center;"><i class="<%= msgItem?.success ? 'fa-regular fa-bell' : 'fa-solid fa-circle-exclamation' %>" style="color:<%= msgItem?.success ? '#484848':'#D04848'  %>"></i>
					<span>
						<%= msgItem?.message || 'Howdy! Here is a quick overview of everything.' %></p>
					</span>
				<button class="close-msg-btn" onclick="closeMessage(this)">&times;</button>
			</div>
		<% }) %>
	</div>
	<div class="dashboard-banner-wr">
		<div class="dashboard-banner-top-cont">
			<h1>Welcome to U-CMS!</h1>
			<h2><a href="/api/v1/manage/documentation">Learn more about the 6.4.3 version.</a></h2>
		</div>
		<div class="dashboard-banner-bottom-cont">
			<div class="dashboard-cont-parent-wr">
				<div><i class="fa-solid fa-pen"></i></div>
				<div>
					<p>Author rich content with blocks and patterns</p>
					<p>Block patterns are pre-configured block layouts. Use them to get inspired or create new pages in a flash.</p>
					<a href="/api/v1/manage/all-pages">Add a new page</a>
				</div>
			</div>
			<div class="dashboard-cont-parent-wr">
				<div><i class='bx bx-layout'></i></div>
				<div>
					<p>Create custom models and combine with repeaters</p>
					<p>Design everything on your site — from the header down to the footer, get everything that your site want.</p>
					<a href="/api/v1/manage/all-pages">Open site editor</a>
				</div>
			</div><div class="dashboard-cont-parent-wr">
				<div><i class="fa-solid fa-circle-half-stroke"></i></div>
				<div>
					<p>Switch up your site’s look & feel with Styles</p>
					<p>weak your site, or give it a whole new look! Get creative — how about a new color palette or font?</p>
					<a href="/api/v1/manage/change-theme">Edit Styles</a>
				</div>
			</div>
		</div>
	</div>
	
	<div class="dashboard-card-wr">
	
		<div class="dashboard-left-card-wr">

			<div class="atA-glance-card">
				<div>
				<div style="width: 100%;display: flex;"  data-bs-toggle="collapse" data-bs-target="#overviewCollapse" aria-expanded="false" aria-controls="overviewCollapse">
					<h2 class="dashboard-card-heading" >At a Glance</h2>
					<button class="dashboard-card-dropdown-btn"><i class="fa-solid fa-caret-down" style="color: #959595;"></i></button>
				</div>
					<div class="collapse show" id="overviewCollapse">
						<div style="border-top: 1px solid rgba(0,0,0,0.25);padding: 10px;">
							<div style="display: flex;align-items: center;padding: 5px;">
								<div style="width: 50%;font-size: 14px;"><i class="fa-solid fa-thumbtack" style="color: #8a8989;"></i> <a href="" style="color: #2271b1;"><%= totalOrders === 1 ? '1 Test Done': (totalOrders+' Tests done') %></a></div>
								<div style="width: 50%;font-size: 14px;"><i class="fa-solid fa-copy" style="color: #8a8989;"></i> <a href="" style="color: #2271b1;"><%= products === 1 ? '1 Product':(products+ ' Products')  %></a></div>
							</div>
							<p style="margin: 10px 0px; font-size: 13px;">Learn more about the stats by visiting the <a href="#" style="color: #2271b1;text-decoration: underline;">documentation</a></p>
						</div>
					</div>
				</div>
			</div>

			<div class="page-activity-card">
				<div style="width: 100%;"  data-bs-toggle="collapse" data-bs-target="#pageActivityCollapse" aria-expanded="false" aria-controls="pageActivityCollapse">
					<div style="display: flex;">
						<h2 class="dashboard-card-heading">Page Activity</h2>
						<button class="dashboard-card-dropdown-btn"><i class="fa-solid fa-caret-down" style="color: #959595;"></i></button>
					</div>
						<div class="collapse" id="pageActivityCollapse">
						<div style="border-top: 1px solid rgba(0,0,0,0.25);">
							<p style="margin: 0px;color: #8a8989;font-size: 14px;font-weight: 400;padding: 10px;">Recently Published</p>
							<table>
								<tbody>
									<% pages?.forEach(page => { %>
										<tr>
											<td class="post-activity-top-td"><p style="margin: 0px;color: #8a8989;font-size: 13px;font-weight: 400;"><%= page?.createdAt %></p></td>
											<td class="post-activity-bottom-td"><p style="margin: 0px;color: #2271b1;font-size: 13px;font-weight: 400;"><%= page?.name %></p></td>
										</tr>
									<% }) %>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

		</div>
		<div class="post-activity-card">
			<div style="width: 100%;">
				<div style="display: flex;" data-bs-toggle="collapse" data-bs-target="#activityCollapse" aria-expanded="false" aria-controls="activityCollapse">
					<h2 class="dashboard-card-heading">Post Activity</h2>
					<button class="dashboard-card-dropdown-btn"><i class="fa-solid fa-caret-down" style="color: #959595;"></i></button>
				</div>
				<div class="collapse show" id="activityCollapse">
					<div style="border-top: 1px solid rgba(0,0,0,0.25);">
						<p style="margin: 0px;color: #8a8989;font-size: 14px;font-weight: 400;padding: 10px;">Recently Published</p>
						<table>
							<tbody>
								<% posts?.forEach(post => { %>
									<tr>
										<td class="post-activity-top-td"><p style="margin: 0px;color: #8a8989;font-size: 13px;font-weight: 400;"><%= post?.createdAt %></p></td>
										<td class="post-activity-bottom-td"><p style="margin: 0px;color: #2271b1;font-size: 13px;font-weight: 400;"><%= post?.postName %></p></td>
									</tr>
								<% }) %>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		<div class="quick-drafts-card">
			<div style="width: 100%;">
				<div  style="display: flex;" data-bs-toggle="collapse" data-bs-target="#quickDraftsCollapse" aria-expanded="false" aria-controls="quickDraftsCollapse">
					<h2 class="dashboard-card-heading">Quick Draft</h2>
					<button class="dashboard-card-dropdown-btn"><i class="fa-solid fa-caret-down" style="color: #959595;"></i></button>
				</div>
				<div class="collapse show" id="quickDraftsCollapse">
					<form action="/api/v1/manage/save-quick-draft" method="post" style="padding: 20px;border-top: 1px solid rgba(0,0,0,0.25);" >
						<div>
							<label class="form-label">Title</label>
							<input class="form-control" type="text" name="draftTitle">
						</div>
						<div>
							<label class="form-label">Description</label>
							<textarea class="form-control" type="text" placeholder="What's on your mind?" name="draftDescription" cols="30" rows="4" style="resize: none;"></textarea>
						</div>
						<div class="mt-3">
							<button class="button-main button-main-md" type="submit">Save Draft</button>
						</div>
					</form>
					<div style="padding: 0 0 10px;">
					<h2 class="dashboard-card-heading">Your recent drafts</h2>
					<ul class="drafts-list-wr">
						<% if (quickDrafts.length === 0) { %>
							<p>No drafts available</p>
						<% } else { %>
						<% quickDrafts.forEach((draft) => { %>
						<li class="hover" style="display: flex;flex-direction: column;">
							<div data-bs-toggle="collapse" data-bs-target="#listCollapse<%= draft._id%>" aria-expanded="false" aria-controls="listCollapse<%= draft._id%>" style="cursor: pointer;">
								<span><%= draft.title %> 
									<code>
										
										<%= ( function formatDate(dateString) {
											const date = new Date(dateString);
											const formattedDate = date.toLocaleDateString('en-US', {
												month: 'short',
												day: '2-digit',
												year: 'numeric'
											});
											return formattedDate;
										})(draft.createdAt) %>

									</code>
									<span class="category-delete-btn" style="position: relative;"><a href="/api/v1/manage/delete-quick-draft?draftId=<%=draft._id%>">
										<i 
										 class="fa-solid fa-trash"></i></a></span>
								</span>
								<button class="dashboard-card-dropdown-btn"><i class="fa-solid fa-caret-down" style="color: #959595;"></i></button>
							</div>
								<span class="collapse show" id="listCollapse<%= draft._id%>"><%= draft.description %></span>
								
						</li>
						<% }); %>
						<% } %>

					</ul>	
					</div>
				</div>
			</div>
		</div>

	</div>
</div>
<script>
	function closeMessage(buttonElement) {
		const container = buttonElement.closest(".msg");
		container.style.display = 'none';
		const parent = buttonElement.closest(".msg-container");
		const children = parent.querySelectorAll(".msg");
		var visibleCount = 0;
		for(var i=0; i<children.length; i++){
			if(window.getComputedStyle(children[i]).display !== none){
				visibleCount++;
			}
		}
		if(visibleCount === 0){
			parent.style.display = 'none'
		}
	}
	
</script>
