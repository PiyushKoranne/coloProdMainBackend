<div style="display: flex;width: 100%;align-items: start;justify-content: start;height: 100%;">

	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<style>
		tbody tr:nth-child(odd) {
			background-color: #f6f7f7;
		}

		tbody tr:nth-child(even) {
			background-color: #fff;
		}
	</style>
	<div id="scrollable-content"
		style="width: 80%;height: 100%;padding: 20px;overflow-y: scroll;border-right: 1px solid rgba(0,0,0,0.25);padding-bottom: 5%;">
		<div>
			<h3>
				<%= postName %>
			</h3>
			<p>Edit this post across the website.</p>
		</div>
		<div
			style="display: flex; align-items: center; justify-content: space-between; width: 100%;padding: 10px 0px 20px 0px; border-bottom: 2px solid #d8d8d8;margin-bottom: 10px;">
			<% if(Object.keys(dataObject).length> 0) { %>
				<p style="margin: 0; font-size: 16px;text-transform: uppercase;font-weight: 600;">Post data:</p>
				<% } %>
		</div>
		<form action="/api/v1/manage/add-post-data" id="add-post-data-form" method="POST" enctype="multipart/form-data">
			<div id="inputs-container" style="width: 100%;">
				<input id="model-name-glb" type="hidden" name="modelName" value="<%= modelName %>">
				<input id="post-name-glb" type="hidden" name="postName" value="<%= postName %>">
				<input id="post-type-id-glb" type="hidden" name="postTypeId" value="<%= postTypeId %>">

				<% if(Object.keys(dataObject).length> 0) { Object.keys(dataObject).forEach(item=> {
					if(dataObject[item] == 'String' || dataObject[item] == 'Number') {
					%>
					<div class="section-input-container">
						<label class="form-label mt-3" for="<%= item %>">
							<%= item %>
						</label>
						<input class="form-control mb-3" step=".01"
							type="<%= dataObject[item] == 'String' ? 'text': dataObject[item] == 'Number' ? 'number' :'text' %>"
							name="<%= item %>" value="<%= postData ? postData[item] : '' %>">
					</div>
					<% } else if(dataObject[item]=='Boolean' ) { %>
						<div class="section-input-container">
							<label class="form-label mt-3" for="<%= item %>">
								<%= item %>
							</label>
							<div class="form-check">
								<input class="form-check-input" value="true" <%=postData && postData[item]==='true' ? 'checked' :'' %>
								type="radio" name="<%= item %>" id="<%= item %>1">
										<label class="form-check-label" for="<%= item %>1">
											True
										</label>
							</div>
							<div class="form-check">
								<input class="form-check-input" value="false" <%=postData && postData[item]==='false' ? 'checked' :'' %>
								type="radio" name="<%= item %>" id="<%= item %>2">
										<label class="form-check-label" for="<%= item %>2">
											False
										</label>
							</div>
						</div>
						<% } else if(dataObject[item]=='Image' ) { %>
							<div class="section-input-container">

								<label class="mb-3 mt-3" style="display: block;">
									<%= item %>
								</label>
								<div class="mb-3">
									<img
										src="/images/<%= postData ? postData[item] : 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMwAAADACAMAAAB/Pny7AAAAOVBMVEX///+hoaGampqdnZ2srKy0tLSoqKjZ2dnq6ur39/fAwMDt7e3g4OC7u7vw8PD6+vqTk5PS0tLIyMhAQKZNAAACjElEQVR4nO3a2XKqQBRAUXsCZGz4/4+9EhCQsS50FYeqvV41hm17Gkh8vQAAAAAAAAAAAAAAAAAAAAAAAAAACCIvXFB1dWNMo01I2iY3xqRGGR2KUcrmt8aYOksCyZ2+OUaH+/VlQUwwxGwRFJM3aXNtYxUTk7hIfRTvCy8mJSZxpm1Rxl2okRKTdi1K6QsXJEJiEvuNUfb80giJiaNvi9Ll6RcTElOrMSY7/WJCYnI7xJjHr0zpvjNzZTsTEjN+zvzueTPVqtl+VErM5y5Nt+vi472dufisnyk2HxYT8/rcjHjtdgcm9n+LV289Lifm9aoOTpel7z+KW/udpJgjw4YXbTzhQTGpHnbvjbF5Tkzu1Wh9bJ4TM21RanWjeExMZH5iVsfmKTHjwPTSlSc9JCbxsxZl4uWzHhKzaFFGLa/hZMZks9PibGA6bvFjImOs99H0fa/nA9NZXHJKjGlvoY0ar22WA9Ob/6TAmObvQLUbatbXpd2fZ2cbeTFxf6T+e5Z3awPTbQKzyxpxMeXwpw3fve/11odsOTbiYsZ16MYm22sx6ue+VFpMMzlUXVST6/71Gju9BxIWk6vpgPh4Z2D6munYyIqp7O+xm+agRf3cDciKKebHvrkrj73RODaiYurDQ1+rGU9IkmKS1Uuw45rhbkBQzPto2LdE37sBQTHpyZbP/tyPjZyYyX81/rumHxsxMYk9uzCtRlRMdXZguqXpxkZKTHN8xLs1LpMTE5/blSc17XWcjJjEHp/qD2LasZER00T2qsglMmKqMguglBATv0NJbo9RLg2liMy9MTrgdzS1uTemjsIqzn+L4Loqj4M6//UOAAAAAAAAAAAAAAAAAAAAAAAAAMBl/wCSoC7OdsS5KwAAAABJRU5ErkJggg==' %>"
										style="width: 150px;height: auto;box-shadow: 2px 2px 12px 0px rgba(0,0,0,0.25);border-radius: 10px;"
										alt="">
								</div>
								<p style="font-size: 14px;margin: 0; padding: 10px 0px;">Currently Chosen: <span
										style="display: inline-block; margin-left: 10px;font-weight: 600;">
										<%= postData ? postData[item] : 'No Image Chosen' %>
									</span></p>
								<input class="form-control mb-3" type="file" name="<%= item %>" value="">
							</div>
							<% } else if(dataObject[item]=='Multiple Images' ) { %>
								<div class="section-input-container">
									<label class="mb-3 mt-3" style="display: block;">
										<%= item %>
									</label>
									<div class="mb-3" style="display: flex;align-items: center;gap: 10px;">
										<% if(postData && postData[item] && postData[item].length> 0) { for(let i=0; i <
												postData[item].length; i++) { %>
												<img
													src="/images/<%= postData ? postData[item][i] : 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMwAAADACAMAAAB/Pny7AAAAOVBMVEX///+hoaGampqdnZ2srKy0tLSoqKjZ2dnq6ur39/fAwMDt7e3g4OC7u7vw8PD6+vqTk5PS0tLIyMhAQKZNAAACjElEQVR4nO3a2XKqQBRAUXsCZGz4/4+9EhCQsS50FYeqvV41hm17Gkh8vQAAAAAAAAAAAAAAAAAAAAAAAAAACCIvXFB1dWNMo01I2iY3xqRGGR2KUcrmt8aYOksCyZ2+OUaH+/VlQUwwxGwRFJM3aXNtYxUTk7hIfRTvCy8mJSZxpm1Rxl2okRKTdi1K6QsXJEJiEvuNUfb80giJiaNvi9Ll6RcTElOrMSY7/WJCYnI7xJjHr0zpvjNzZTsTEjN+zvzueTPVqtl+VErM5y5Nt+vi472dufisnyk2HxYT8/rcjHjtdgcm9n+LV289Lifm9aoOTpel7z+KW/udpJgjw4YXbTzhQTGpHnbvjbF5Tkzu1Wh9bJ4TM21RanWjeExMZH5iVsfmKTHjwPTSlSc9JCbxsxZl4uWzHhKzaFFGLa/hZMZks9PibGA6bvFjImOs99H0fa/nA9NZXHJKjGlvoY0ar22WA9Ob/6TAmObvQLUbatbXpd2fZ2cbeTFxf6T+e5Z3awPTbQKzyxpxMeXwpw3fve/11odsOTbiYsZ16MYm22sx6ue+VFpMMzlUXVST6/71Gju9BxIWk6vpgPh4Z2D6munYyIqp7O+xm+agRf3cDciKKebHvrkrj73RODaiYurDQ1+rGU9IkmKS1Uuw45rhbkBQzPto2LdE37sBQTHpyZbP/tyPjZyYyX81/rumHxsxMYk9uzCtRlRMdXZguqXpxkZKTHN8xLs1LpMTE5/blSc17XWcjJjEHp/qD2LasZER00T2qsglMmKqMguglBATv0NJbo9RLg2liMy9MTrgdzS1uTemjsIqzn+L4Loqj4M6//UOAAAAAAAAAAAAAAAAAAAAAAAAAMBl/wCSoC7OdsS5KwAAAABJRU5ErkJggg==' %>"
													style="width: 150px;height: auto;box-shadow: 2px 2px 12px 0px rgba(0,0,0,0.25);border-radius: 10px;"
													alt="">
												<% }} %>
									</div>
									<input class="form-control mb-3" type="file" multiple name="<%= item %>" value="">
									<div id="fileList"></div>
								</div>
								<% } else if(dataObject[item]=='Mixed' ) { %>
									<div class="section-input-container">
										<label class="form-label mt-3" for="<%= item %>">
											<%= item %>
										</label>
										<textarea class="mb-3" name="<%= item %>">
										<%= postData ? postData[item] : '' %>
									</textarea>
									</div>
									<% } else if(dataObject[item]=='Array' ) { %>
										<div style="font-size: 13px;">
											<label class="form-label mt-3">
												<%= item %>
											</label>
											<button onclick="openItemModal('<%= item %>')" type="button" class="button-secondary"
												style="display: block;margin-bottom: 15px;">
												<i class="fa-solid fa-plus" style="margin-right: 10px;"></i>Add new item
											</button>
											<% if(postData && postData[item] && postData[item]?.length> 0) { %>
												<table width="100%" cellpadding="0" cellspacing="0" style="border: 1px solid rgba(0,0,0,0.25);">
													<thead>
														<tr style="border-bottom: 1px solid rgba(0,0,0,0.25);background-color:#fff;">
															<th></th>
															<th style="padding: 10px;">Index</th>
															<th>Id</th>
															<th>Item</th>
															<th>Item Type</th>
															<th>Actions</th>
														</tr>
													</thead>
													<tbody class="sortable" data-arrayname="<%= item %>">
														<% postData[item].forEach((arrayitem, index)=> { %>
															<tr style="border-bottom: 1px solid rgba(0,0,0,0.25);color: #2271B7;">
																<td style="padding: 5px 10px;font-size: 13px;font-weight: 600;">
																	<i style="cursor: grab;" class="fa-solid fa-grip-vertical"></i>
																</td>
																<td style="padding: 5px 10px;font-size: 13px;font-weight: 600;">
																	<%= index+1 %>
																</td>
																<td style="padding: 5px 10px;font-size: 13px;font-weight: 600;">
																	<%= arrayitem?.id %>
																</td>
																<td style="padding: 5px 10px;font-size: 13px;font-weight: 600;">
																	<% if(arrayitem.type==="String" ) { %>
																		<%= arrayitem.value %>
																			<% } else if(arrayitem.type==="PostLink" ) { %>
																				<%= arrayitem.value.split("__")[0] %>
																					<% } else if(arrayitem.type==="Textarea" ) { %>
																						<button class="button-secondary">
																							<strong style="color: #2a5298;">Text Content</strong> (Click to View)
																						</button>
																						<% } else if(arrayitem.type==="JSON" ) { %>
																							<button type="button"
																								onclick="openJSONViewer('<%= item %>', '<%= arrayitem.id %>', '<%= arrayitem.type %>', '<%= JSON.stringify(arrayitem.value) %>', '<%= index %>' )"
																								class="button-secondary"><strong style="color: #2a5298;">JSON
																									Data</strong> (Click to
																								View)</button>
																							<% } else if(arrayitem.type==="Image" ) { %>
																								<img src="/images/<%= arrayitem.value %>" width="50" alt="">
																								<% } %>
																</td>
																<td style="padding: 5px 10px;font-size: 13px;font-weight: 600;">
																	<%= arrayitem.type %>
																</td>
																<td style="padding: 5px 10px;font-size: 13px;font-weight: 600;">
																	<i class="fa-solid fa-trash-can" style="cursor: pointer;"
																		onclick="deleteArrayItem('<%= item %>', '<%= arrayitem.id %>')"></i>
																</td>
															</tr>
															<% }) %>
													</tbody>
												</table>
												<% } %>
										</div>

										<% } else if(item==='repeaters' && dataObject.hasOwnProperty(item) && dataObject[item]?.length> 0) {
											dataObject[item]?.forEach(repeaterItem => { %>
											<div style="margin-bottom: 15px;">
												<label style="display: block;margin:10px 0px" for="">
													<%= repeaterItem?.repeaterLabel %>
												</label>
												<button type="button"
													onclick="openRepeaterModal('<%= repeaterItem?.id %>', '<%= JSON.stringify(repeaterItem) %>')"
													class="button-secondary">Add Repeater Item</button>
											</div>
											<% if( postData && postData[item]?.filter(postrepeaterItem=> postrepeaterItem?.repeaterId ==
												repeaterItem?.id )?.length > 0){
												postData[item]?.filter(postrepeaterItem => postrepeaterItem?.repeaterId == repeaterItem?.id
												).forEach( postRepItem => {
												%>
												<div style="overflow-x: auto;width: 100%;">
													<table style="width: 100%;" cellpadding="0" cellspacing="0"
														style="border: 1px solid rgba(0,0,0,0.25);">
														<thead>
															<tr style="border: 1px solid rgba(0,0,0,0.25); background-color: #fff;">
																<% repeaterItem?.fields?.forEach(modelField=> { %>
																	<th style="padding: 10px;font-size: 13px;font-weight: 500;">
																		<%= modelField?.fieldLabel %>
																	</th>
																	<% }) %>
																		<th style="padding: 10px;font-size: 13px;font-weight: 500;">Actions</th>
															</tr>
														</thead>
														<tbody>
															<% postRepItem?.data?.forEach( (dataField, dataFieldIndex)=> { %>
																<tr style="border: 1px solid rgba(0,0,0,0.25);color: #2271B7;">
																	<% repeaterItem?.fields?.forEach(fieldItem=> { %>
																		<td style="padding: 5px 10px;font-size: 13px;font-weight: 500;">
																			<% if(repeaterItem.fields.find(obj=> obj.fieldName ==
																				fieldItem?.fieldName).fieldType == "Text") { %>
																				<input disabled class="form-control"
																					style="border: 1px solid rgba(0,0,0,0.25);width: 150px;" type="text"
																					value="<%= dataField[fieldItem?.fieldName] || '' %>">
																				<% } else if(repeaterItem.fields.find(obj=> obj.fieldName ==
																					fieldItem?.fieldName).fieldType == "Editor") { %>
																					<textarea disabled
																						style="height: 100px;width: 200px;border: 1px solid rgba(0,0,0,0.25);"
																						class="repeater-textarea"><%= dataField[fieldItem?.fieldName] || "" %></textarea>
																					<% } else if (repeaterItem.fields.find(obj=> obj.fieldName ==
																						fieldItem?.fieldName).fieldType == "Image") { %>
																						<img
																							src="/images/<%= dataField[fieldItem?.fieldName] || 'placeholder.jpg' %>"
																							style="object-fit: cover;width: 55px;height: 55px;border: 1px solid rgba(0,0,0,0.25);border-radius: 6px;"
																							alt="<%= dataField[fieldItem?.fieldName] %>">
																						<% } else if(repeaterItem.fields.find(obj=> obj.fieldName ==
																							fieldItem?.fieldName).fieldType == "URL") { %>
																							<a href="<%= dataField[fieldItem?.fieldName] %>">
																								<%= dataField[fieldItem?.fieldName] %>
																							</a>
																							<% } else { %>
																								<%= dataField[fieldItem?.fieldName] %>
																									<% } %>
																		</td>
																		<% }) %>
																			<td align="center">
																				<i onclick="viewRepeaterItem('<%= postRepItem?.repeaterId %>', '<%= dataFieldIndex %>')"
																					style="font-size: 11px;color: #484848;margin-right: 4px;cursor: pointer;"
																					class="fa-solid fa-eye"></i>
																				<i style="font-size: 11px;color: #484848;cursor: pointer;"
																					class="fa-solid fa-trash-can"></i>
																			</td>
																</tr>
																<% }) %>
														</tbody>
													</table>
												</div>
												<% })} %>

													<% })}})} else { %>
														<div>
															<div style="border-bottom: 1px solid rgba(0,0,0,0.25);padding: 25px 0px;width: 100%;">
																<div
																	style="margin: 0 auto;display: flex;flex-direction: column;align-items: center;justify-content: start;gap: 25px;width: 80%;">
																	<input value="<%= defaultPostTitle %>"
																		style="width: 100%;font-size: 54px !important;padding: 15px 25px;" type="text"
																		placeholder="Add Post Title" name="defaultPostTitle" id="default-post-title">
																	<textarea id="default-post-content" style="padding: 15px 25px;"
																		name="defaultPostContent" cols="30" rows="10"
																		placeholder="Start writing text or HTML">
														<%= defaultPostContent %>
													</textarea>
																</div>
															</div>
														</div>
														<% } %>
			</div>
		</form>

		<div id="arrayItemModal" class="modal">
			<div class="modal-content" id="modal-input-container">
				<span class="close" onclick="closeArrayItemModal()">&times;</span>
				<input type="hidden" name="modelName" value="<%= modelName %>">
				<input type="hidden" id="arrayItemNamePointer" name="arrayItemNamePointer">
				<input type="hidden" name="postName" value="<%= postName %>">
				<input type="hidden" name="postTypeId" value="<%= postTypeId %>">
				<div id="item-modal-content" style="padding: 20px 0;font-size: 13px;">
					<label for="itemType" class="mb-3">Choose the item type</label>
					<select onchange="chooseItemType()" name="itemType" id="itemType"
						style="display: block;width: 100%;padding: 5px 10px; background-color: aliceblue;margin-bottom: 5px;">
						<option value="">Choose a type</option>
						<option value="PostLink">PostLink</option>
						<option value="String">String</option>
						<option value="Textarea">Textarea</option>
						<option value="JSON">JSON</option>
						<option value="Image">Image</option>
					</select>
					<select onchange="choosePostType(this)" name="chosenLinkingPostType" id="chosenLinkingPostType"
						style="display: none;width: 100%;padding: 5px 10px; background-color: aliceblue;margin-bottom: 5px;">
						<option value="">Choose a post-type</option>
						<% if(allPostTypes && allPostTypes?.length> 0){ allPostTypes.forEach(item => { %>
							<option value="<%= item?._id %>">
								<%= item?.postTypeName %>
							</option>
							<% }) } %>
					</select>
					<div id="post-linking-container">

					</div>
					<button id="add-item-last-btn" class="mt-3 button-main button-main-md" onclick="addItem()">Add Item</button>
				</div>
			</div>
		</div>



		<!-- [START] NEW MODAL FOR ASSIGNING BATTERY TYPE (MORE THAN ONE) AND ASSIGNING VEHICLE MODELS (MORE THAN ONE) : -->
		<div id="specialArrayItemModal" class="modal">
			<div class="modal-content" id="modal-input-container">
				<span class="close" onclick="closeSpecialModal()">&times;</span>
				<input type="hidden" name="modelName" value="<%= modelName %>">
				<input type="hidden" id="arrayItemNamePointer" name="arrayItemNamePointer">
				<input type="hidden" name="postName" value="<%= postName %>">
				<input type="hidden" name="postTypeId" value="<%= postTypeId %>">
				<div id="item-modal-content" style="padding: 20px 0;font-size: 13px;">
					<div id="spec-post-linking-container">


						<!-- // show here battery category selector
						// show here equipment selector

						// select battery category and equipment together -->
					</div>
					<button id="add-item-last-btn" class="mt-3 button-main button-main-md" onclick="addSpecialItem()">Add Item</button>
				</div>
			</div>
		</div>
		<!-- [END] NEW MODAL FOR ASSIGNING BATTERY TYPE (MORE THAN ONE) AND ASSIGNING VEHICLE MODELS (MORE THAN ONE) : -->



		<div id="repeaterModal" class="modal">
			<div class="modal-content">
				<span class="close" onclick="closeRepeaterModal()">&times;</span>
				<form action="/api/v1/manage/add-post-repeater-item" method="post" enctype="multipart/form-data">
					<input type="hidden" name="modelName" value="<%= modelName %>">
					<input type="hidden" name="postName" value="<%= postName %>">
					<input type="hidden" name="postTypeId" value="<%= postTypeId %>">
					<h5 style="margin: 15px 0px;">Enter Repeater details</h5>
					<p style="font-size: 12px;margin: 0px;padding: 10px;background-color: #54f4ff41;border-radius: 6px;">
						<strong>Note that</strong> the data you add for this repeater will be accessible seperately, only the fields
						specified in the repeater custom field can be added. Edit the repeater custom fields to add more data.
					</p>
					<div id="repeater-fields-container">

					</div>
					<div style="text-align: right;">
						<button class="button-secondary"
							style="border: 1px solid #54b2ff; color: #54b2ff;background-color: #fff;font-weight: 600;">Update
							Data</button>
					</div>
				</form>
			</div>
		</div>

		<div id="jsonviewModal" class="modal">
			<div class="modal-content" id="modal-input-container">
				<span class="close" onclick="closeJsonViewModel()">&times;</span>
				<!-- <form action="/api/v1/manage/add-post-array-item" method="POST" enctype="multipart/form-data"> -->
				<input type="hidden" name="modelName" value="<%= modelName %>">
				<input type="hidden" id="arrayName" name="arrayName">
				<input type="hidden" id="itemId" name="itemId">
				<input type="hidden" id="arrayIndex" name="arrayIndex">
				<div id="item-modal-content" style="padding: 20px 0;font-size: 13px;">
					<label for="jsonContent" style="display: block;" class="mb-3">Choose the item type</label>
					<textarea id="jsonContent" style="width: 100%;height: 200px;" type="text"></textarea>
				</div>
				<button class="button-main button-main-md" onclick="updateJSON()">Update JSON</button>
				<!-- </form> -->
			</div>
		</div>
	</div>
	<div
		style="width: 20%;display: flex;flex-direction: column;padding: 20px;align-items: start; justify-content: start;gap: 15px; height: 100%; overflow-y: auto;">
		<div
			style="background-color: #fff;border-radius: 8px; padding: 10px; width: 100%;border: 1px solid rgba(0,0,0,0.25);display: flex;flex-direction: column;gap: 5px;">
			<h5
				style="font-weight: 600; font-size: 13px; text-transform: uppercase;margin-bottom: 5px; border-bottom: 1px solid rgba(0,0,0,0.25);padding-bottom: 5px;">
				Summary</h5>
			<table cellpadding="0" cellspacing="0">
				<tr>
					<td style="width: 80px;">
						<!-- <i style="text-align: center;width: 15px;display: inline-block;color: #484848;font-size: 14px;"
					class="fa-solid fa-map-pin"></i> -->
						<span style="display: inline-block;color: #484848;font-weight:500;font-size: 13px;">Status</span>
					</td>
					<td>
						<div class="dropdown">
							<span class="sidemenu-summary-btn dropdown-toggle" data-bs-auto-close="outside"
								style="width: 100%;padding: 5px;display: inline-block;font-weight:600;font-size: 13px;text-transform: uppercase;color:<%= status == 'published' ? '#65B741' : '#2a5298'  %>"
								type="button" data-bs-toggle="dropdown" aria-expanded="false">
								<%= status || "unset" %>
							</span>
							<div class="dropdown-menu" style="box-shadow: 4px 4px 12px 0 rgba(0,0,0,0.25);">
								<div
									style="display: flex;align-items: start;justify-content: start;flex-direction: column;padding: 10px;width: 300px;">
									<h5 style="font-size: 14px;">Publish this post:</h5>
									<p style="margin: 0;font-size: 11px;font-weight: 400;margin-bottom: 10px;">Manage the status of this
										post, a only posts that are published will be accessible publicly.</p>
									<div style="display: flex;align-items: center;padding: 5px;gap: 5px;">
										<input type="radio" value="published" onchange="handlePageStatus()" <%=status=="published"
											&& "checked" %> name="pageStatus" id="publishPage">
										<label for="publishPage" style="font-size: 12px;font-weight: 500;">Publish</label>
									</div>
									<div style="display: flex;align-items: center;padding: 5px;gap: 5px;margin-bottom: 10px;">
										<input type="radio" value="draft" onchange="handlePageStatus()" <%=status=="draft" && "checked" %>
										name="pageStatus" id="withdrawPage">
										<label for="withdrawPage" style="font-size: 12px;font-weight: 500;">Draft</label>
									</div>
								</div>
							</div>
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<span style="display: inline-block;color: #484848;font-weight:500;font-size: 13px;">Visibility</span>
					</td>
					<td>
						<div class="dropdown">
							<span class="sidemenu-summary-btn dropdown-toggle" data-bs-auto-close="outside"
								style="width: 100%;padding: 5px;display: inline-block;color: #484848;font-weight:500;font-size: 13px;text-transform: uppercase;"
								type="button" data-bs-toggle="dropdown" aria-expanded="false">
								<%= visibility || 'unset' %>
							</span>
							<div class="dropdown-menu" style="box-shadow: 4px 4px 12px 0 rgba(0,0,0,0.25);">
								<div
									style="display: flex;align-items: start;justify-content: start;flex-direction: column;padding: 10px;width: 300px;">
									<h5 style="font-size: 14px;">Page Visibility:</h5>
									<p style="margin: 0;font-size: 11px;font-weight: 400;margin-bottom: 10px;">Manage the visibility of
										this page, a only posts that are visible will be accessible publicly.</p>
									<div style="display: flex;align-items: center;padding: 5px;gap: 5px;">
										<input onchange="handlePostVisibility()" <%=visibility=="visible" && "checked" %> value="visible"
										type="radio" name="pageVisibility" id="makePageVisible">
										<label for="makePageVisible" style="font-size: 12px;font-weight: 500;">Visible (Public)</label>
									</div>
									<div style="display: flex;align-items: center;padding: 5px;gap: 5px;">
										<input onchange="handlePostVisibility()" <%=visibility=="hidden" && "checked" %> value="hidden"
										type="radio" name="pageVisibility" id="makePageHidden">
										<label for="makePageHidden" style="font-size: 12px;font-weight: 500;">Hidden</label>
									</div>
								</div>
							</div>
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<span style="display: inline-block;color: #484848;font-weight:500;font-size: 13px;">Revisions</span>
					</td>
					<td>
						<span class="sidemenu-summary-btn"
							style="width: 100%;padding: 5px;display: inline-block;color: #484848;font-weight:500;font-size: 13px;">
							<%= revisions %>
						</span>
					</td>
				</tr>
				<tr>
					<td>
						<span style="display: inline-block;color: #484848;font-weight:500;font-size: 13px;">URL</span>
					</td>
					<td>
						<div class="dropdown">
							<span class="sidemenu-summary-btn dropdown-toggle"
								style="width: 100%;padding: 5px;display: inline-block;color: #54b2ff;font-weight:600;font-size: 13px;font-family: Arial, Helvetica, sans-serif;"
								type="button" data-bs-toggle="dropdown" aria-expanded="false">
								<%= permaLink || 'url not found' %>
							</span>
							<div class="dropdown-menu" style="box-shadow: 4px 4px 12px 0 rgba(0,0,0,0.25);">
								<div
									style="display: flex;align-items: start;justify-content: start;flex-direction: column;padding: 10px;width: 300px;">
									<p style="margin: 0;font-size: 11px;font-weight: 400;">This slug will be used as a unique route for
										your webpage or webpost.</p>
									<form action="/api/v1/manage/update-post-permalink" method="post">
										<label for="url-post" style="font-size: 12px;margin-top: 10px;">permalink</label>
										<div style="display: flex;align-items: center;">
											<input style="font-weight: 600;font-size: 12px !important;" class="form-control" type="text"
												name="permalink" id="url-post" value="<%= permaLink %>">
											<input type="hidden" name="postName" value="<%= postName %>">
											<input type="hidden" name="postTypeId" value="<%= postTypeId %>">
											<button class="button-secondary"
												style="background-color: #42be6c42;text-transform: uppercase;font-size: 11px;font-weight: 600;">Publish</button>
										</div>
									</form>
								</div>
							</div>
						</div>
					</td>
				</tr>
			</table>
			<button type="submit" form="add-post-data-form" class="mt-3 button-main button-main-md">Update Post</button>
			<div
				style="display: flex;align-items: center;justify-content: space-between;border-top:1px solid rgba(0,0,0,0.25);padding: 10px;">
				<p style="margin: 0;font-weight: 500;color: #872341;font-size: 14px;">Delete this post</p>
				<button class="button-main button-main-md button-danger"
					onclick="deletePost('<%= postId %>', '<%= postTypeId %>')">Delete</button>
			</div>
		</div>
		<div
			style="color: #484848;font-weight:500;font-size: 13px;background-color: #fff;border-radius: 8px; padding: 10px; width: 100%;border: 1px solid rgba(0,0,0,0.25);display: flex;flex-direction: column;gap: 5px;">
			<h5
				style="font-weight: 600; font-size: 13px; text-transform: uppercase;margin-bottom: 15px; border-bottom: 1px solid rgba(0,0,0,0.25);padding-bottom: 5px;">
				ACF DATA
			</h5>
			<div style="display: flex;align-items: center;gap: 10px;">
				<i style="text-align: center;width: 15px;display: inline-block;color: #484848;font-size: 14px;"
					class="fa-solid fa-link"></i>
				<span style="display: inline-block;font-weight: 600;">Linked ACF:</span>
			</div>
			<% if(!Object.keys(dataObject).length> 0) { %>
				<p style="margin: 0; color: #a1a1a1;">No fields linked yet</p>
				<a href="/api/v1/manage/all-models" class="button-secondary">Add Custom Field</a>
				<% } %>
					<% if(customFields.length> 0) { %>
						<ul>
							<% customFields.forEach((item, index)=> { %>
								<li>
									<p style="margin: 0;font-size: 13px;">
										<%= item %>
											<span>
												<a href="/api/v1/manage/rendermodel?modelname=<%= customFieldIds[index] %>"
													style="color: #2a5298;font-weight: 600;margin-left: 10px;">View</a>
											</span>
									</p>
								</li>
								<% }) %>
						</ul>
						<% } %>
		</div>
		<div
			style="color: #484848;font-weight:500;font-size: 13px;background-color: #fff;border-radius: 8px; padding: 10px; width: 100%;border: 1px solid rgba(0,0,0,0.25);display: flex;flex-direction: column;gap: 5px;">
			<h5
				style="font-weight: 600; font-size: 13px; text-transform: uppercase;margin-bottom: 15px; border-bottom: 1px solid rgba(0,0,0,0.25);padding-bottom: 5px;">
				Category
			</h5>
			<div style="display: flex;align-items: center;gap: 10px;">
				<i style="text-align: center;width: 15px;display: inline-block;color: #484848;font-size: 14px;"
					class="fa-solid fa-link"></i>
				<span style="display: inline-block;font-weight: 600;">Linked Categories:</span>
			</div>
			<% if(category?.length> 0) { %>
				<ul style="padding: 0; height: 80px;overflow-y: scroll;">
					<% category.forEach((item, index)=> { %>
						<li
							style="background: #fff;border-bottom: 1px solid rgba(0,0,0,0.25);list-style: none;padding: 5px;display: flex;align-items:center;justify-content: space-between;">
							<p style="margin: 0;font-size: 12px;">
								<%= item?.categoryName %>
							</p>
							<p style="margin: 0;cursor: pointer;"
								onclick="removeCategory('<%= item?.categoryName %>','<%= item?._id %>','<%= postName %>', '<%= postTypeId %>')">
								<i style="font-size: 12px;color: #484848;" class="fa-solid fa-link-slash"></i>
							</p>
						</li>
						<% }) %>
				</ul>
				<% } else { %>
					<p style="margin: 0; color: #a1a1a1;">No categories linked yet</p>
					<% } %>
						<div style="display: flex;align-items: center;gap: 10px; margin-top: 15px;">
							<i style="text-align: center;width: 15px;display: inline-block;color: #484848;font-size: 14px;"
								class="fa-solid fa-plus"></i>
							<span style="display: inline-block;font-weight: 600;">Add Categories:</span>
						</div>
						<form action="/api/v1/manage/add-post-category" method="POST" style="width: 100%;">
							<input type="hidden" name="postName" value="<%= postName %>">
							<input type="hidden" name="postTypeId" value="<%= postTypeId %>">
							<select name="postCategoryIdSelect" id="post-category-selector"
								style="padding: 5px;background-color: aliceblue;width: 100%;">
								<option value="">Choose a category</option>
								<% if(allCategories?.length> 0) { allCategories.forEach((item, index) => { %>
									<option value="<%= item?._id %>">
										<%= item?.categoryName %>
									</option>
									<% })} %>
							</select>
							<button class="button-main button-main-md mt-2">Add</button>
						</form>
						<div>
							<div style="display: flex;align-items: center;gap: 10px; margin-top: 15px; margin-bottom: 10px;">
								<i style="text-align: center;width: 15px;display: inline-block;color: #484848;font-size: 14px;"
									class="fa-solid fa-scroll"></i>
								<span style="display: inline-block;font-weight: 600;">New Category:</span>
							</div>
							<form action="/api/v1/manage/create-post-category" method="POST">
								<input type="hidden" name="postName" value="<%= postName %>">
								<input type="hidden" name="postTypeId" value="<%= postTypeId %>">
								<label for="newCategoryName" style="font-size: 12px;color: #7e7c7c;">category
									name</label>
								<input type="text" name="newCategoryName"
									style="outline:none;border-radius: 6px;border: 1px solid rgba(0,0,0,0.25);padding: 5px;width: 100%;"
									id="newCategoryName">
								<button class="button-secondary" style="margin: 10px 0px;">Create new category</button>
							</form>
						</div>
		</div>
	</div>
	<script src="https://unpkg.com/sortablejs@1.14.0/Sortable.min.js"></script>
	<script>
		let equipmentArrayGlb = [];
		let repeaterFormDataGlb = new FormData();
		function resetRepeaterFormData() {
			repeaterFormDataGlb = new FormData();
		}
		let arrayItemNamePointer;
		let multifilescontainer;
		window.addEventListener("DOMContentLoaded", () => {

			const textareaElements = document.querySelectorAll('textarea:not(#jsonContent):not(.repeater-textarea)');
			textareaElements.forEach(textarea => {
				CKEDITOR.replace(textarea, {
					on: {
						instanceReady: function (evt) {
							evt.editor.textareaName = textarea.getAttribute("name");
						}
					}
				});
			});
			new Sortable(document.querySelector('.sortable'), {
				animation: 150, // Customize the animation speed
				direction: 'vertical', // Allow vertical sorting only
				onEnd: function (evt) {
					var newOrder = Array.from(evt.from.children).map(function (el) {
						const dataElem = el.querySelector("td:nth-child(3)")
						return dataElem.textContent.trim()
					});
					const postName = document.getElementById("post-name-glb").value;
					const postTypeId = document.getElementById("post-type-id-glb").value;
					fetch("/api/v1/manage/order-post-array-item", {
						method: "POST",
						headers: {
							"Content-Type": "application/json"
						},
						body: JSON.stringify({ postName, postTypeId, arrayItemNamePointer: evt.to.dataset.arrayname, order: newOrder })
					})
						.then(res => res.json())
						.then(data => { })
				},
			});
		});

		function viewRepeaterItem(repeaterId, repeaterItemIndex) {
			console.log("View Repeater Item...")
			const modelName = document.getElementById("model-name-glb").value;
			const postName = document.getElementById("post-name-glb").value;
			const postTypeId = document.getElementById("post-type-id-glb").value;
			const redirect_url = `/api/v1/manage/render-post-repeater-item?modelName=${encodeURIComponent(modelName)}&postName=${encodeURIComponent(postName)}&postTypeId=${encodeURIComponent(postTypeId)}&repeaterId=${encodeURIComponent(repeaterId)}&repeaterItemIndex=${encodeURIComponent(repeaterItemIndex)}`
			window.location.href = redirect_url;
		}

		function openRepeaterModal(repeaterId, repeaterFieldData) {
			console.log("opening repeater modal...")
			const repeaterFieldsObject = JSON.parse(repeaterFieldData);
			document.querySelector('#repeaterModal').style.display = "block";
			const container = document.querySelector("#repeater-fields-container");
			const inputelem = document.createElement("input");
			inputelem.type = 'hidden'
			inputelem.setAttribute('name', 'repeaterId')
			inputelem.value = repeaterId;
			container.appendChild(inputelem);
			repeaterFieldsObject.fields?.forEach(fieldItem => {
				if (fieldItem?.fieldType === "Text") {
					const element = document.createElement("div");
					const htmlText = `
						<label class="form-label mt-3">
							${fieldItem?.fieldLabel}
						</label>
						<input class="form-control mb-3" type="text" name="${fieldItem?.fieldName}">
					`;
					element.innerHTML = htmlText;
					container.appendChild(element);
				} else if (fieldItem?.fieldType === "Editor") {
					const element = document.createElement("div");
					const htmlText = `
						<label class="form-label mt-3">
							${fieldItem?.fieldLabel}
						</label>
						<textarea class="form-control mb-3" type="text" name="${fieldItem?.fieldName}"></textarea>
					`;
					element.innerHTML = htmlText;
					container.appendChild(element);
				} else if (fieldItem?.fieldType === "Image") {
					const element = document.createElement("div");
					const htmlText = `
						<label class="form-label mt-3">
							${fieldItem?.fieldLabel}
						</label>
						<div style="margin:10px 0px;"><img src="" alt="" ></div>	
						<input class="form-control mb-3" type="file" name="${fieldItem?.fieldName}">
					`;
					element.innerHTML = htmlText;
					container.appendChild(element);
				} else if (fieldItem?.fieldType === "URL") {
					const element = document.createElement("div");
					const htmlText = `
						<label class="form-label mt-3">
							${fieldItem?.fieldLabel}
						</label>
						<input class="form-control mb-3" type="text" name="${fieldItem?.fieldName}">
					`;
					element.innerHTML = htmlText;
					container.appendChild(element);
				}
			})
		}

		function closeRepeaterModal() {
			console.log("closing repeater modal...");
			document.querySelector('#repeaterModal').style.display = "none";
			const container = document.querySelector("#repeater-fields-container");
			container.innerHTML = "";
		}

		function handlePostVisibility() {
			console.log("handle page visibility called...")
			const selectedValue = document.querySelector('input[name="pageVisibility"]:checked').value;
			const postName = document.getElementById("post-name-glb").value;
			const postTypeId = document.getElementById("post-type-id-glb").value;
			console.log("making request to change post visibility");
			fetch("/api/v1/manage/change-post-visibility", {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify({ postName, postTypeId, selectedValue })

			})
				.then(res => res.json())
				.then(data => { })
		}

		function handlePageStatus() {
			console.log("handle page status called...");
			const selectedValue = document.querySelector('input[name="pageStatus"]:checked').value;
			const postName = document.getElementById("post-name-glb").value;
			const postTypeId = document.getElementById("post-type-id-glb").value;
			fetch("/api/v1/manage/change-post-status", {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify({ postName, postTypeId, selectedValue })

			})
				.then(res => res.json())
				.then(data => { })
		}

		function deleteArrayItem(arrayName, itemId) {
			console.log("deleting array item...");
			const postName = document.getElementById("post-name-glb").value;
			const postTypeId = document.getElementById("post-type-id-glb").value;

			fetch("/api/v1/manage/delete-post-array-item", {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify({ postName, postTypeId, arrayName, itemId })
			})
				.then(res => res.json())
				.then(data => window.location.reload())
		}

		function openJSONViewer(arrayName, itemId, itemType, itemValue, index) {
			console.log("opening JSON viewer...");
			document.getElementById("jsonviewModal").style.display = "block";
			document.getElementById("jsonContent").value = itemValue;
			document.getElementById("itemId").value = itemId;
			document.getElementById("arrayName").value = arrayName;
			document.getElementById("arrayIndex").value = index;
			console.log("opened JSON viewer");
		}

		function closeJsonViewModel() {
			document.getElementById("jsonviewModal").style.display = "none";
		}

		function updateJSON() {
			console.log("updating JSON data...");
			const itemValue = document.getElementById("jsonContent").value;
			const itemType = "JSON";
			const itemId = document.getElementById("itemId").value;
			const postName = document.getElementById("post-name-glb").value;
			const postTypeId = document.getElementById("post-type-id-glb").value;
			const arrayName = document.getElementById("arrayName").value;
			const arrayIndex = document.getElementById("arrayIndex").value;

			fetch("/api/v1/manage/update-post-array-item", {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify({ postName, postTypeId, arrayName, arrayIndex, itemId, itemType, itemValue })
			})
				.then(res => res.json())
				.then(data => window.location.reload())
		}

		function addItem() {
			console.log("adding array item...");
			const formData = new FormData();
			const container = document.querySelector("#modal-input-container");
			const selector = container.querySelector("#itemType");
			const allSelects = container.querySelectorAll('select');
			allSelects.forEach(select => {
				formData.append(select.getAttribute("name"), select.value);
			})
			const allInputs = container.querySelectorAll("input:not([type='file'])");
			if (allInputs?.length > 0) {
				allInputs.forEach(input => {
					formData.append(input.getAttribute("name"), input.value);
				})
			}
			const textarea = container.querySelector("#array-item-textarea");
			if (textarea) {
				formData.append(textarea.getAttribute("name"), textarea.value);
			}
			const allFileInputs = container.querySelectorAll("input[type='file']");
			if (allFileInputs?.length > 0) {
				allFileInputs.forEach(fileInput => {
					formData.append(fileInput.getAttribute("name"), fileInput.files[0])
				});
			}
			fetch("/api/v1/manage/add-post-array-item", {
				method: "POST",
				body: formData
			})
				.then(res => res.json())
				.then(data => window.location.reload())
		}

		function addSpecialItem() {
			// array of the equipment ids
			const batteryId = "<%= postId %>";
			const equipmentsArray = equipmentArrayGlb;
			const batteryName = "<%= postData?.name %>";
			const batteryCategory = document.getElementById('linkingPostSelect').value;

			console.log(batteryId, batteryName, equipmentsArray, batteryCategory);


			fetch("/api/v1/manage/add-battery-cat-equip", {
				method:"POST",
				headers: {
					'Content-Type': 'application/json'
				},
				body:JSON.stringify({batteryId, batteryName, equipmentsArray, batteryCategory}),
			})
			.then(res => res.json())
			.then(data => {
				console.log(data);
				if(data?.success){
					window.location.reload();
				}
			})
		}

		function removeCategory(categoryName, categoryId, postName, postTypeId) {
			console.log("Removing category...");
			fetch("/api/v1/manage/unlink-category", {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify({ categoryName, categoryId, postName, postTypeId })
			})
				.then(res => res.json)
				.then(data => {
					window.location.reload();
				})
				.catch(err => console.log(err))
		}

		function deletePost(postId, postTypeId) {
			console.log("Deleting post...");
			Swal.fire({
				title: 'Do you want to delete this post?',
				showDenyButton: true,
				showCancelButton: false,
				confirmButtonText: 'Delete',
				denyButtonText: 'Cancel',
				customClass: {
					actions: 'my-actions',
					cancelButton: 'order-1 right-gap',
					confirmButton: 'order-2',
				},
			}).then((result) => {
				if (result.isConfirmed) {
					fetch("/api/v1/manage/remove-post", {
						method: "POST",
						headers: {
							"Content-Type": "application/json"
						},
						body: JSON.stringify({ postId })
					})
						.then(res => res.json())
						.then(data => { window.location.href = `/api/v1/manage/show-posts-by-post-type/${postTypeId}`; })
				} else if (result.isDenied) {
					Swal.fire('Changes are not saved', '', 'info')
				}
			})
		}

		function closeSpecialModal() {
			console.log('Closing special modal')
			equipmentArrayGlb = [];
			document.getElementById("specialArrayItemModal").style.display = "none";
		}


		function openItemModal(itemName) {
			arrayItemNamePointer = itemName;
			if (itemName === "batterycategory") {
				document.getElementById("specialArrayItemModal").style.display = "block";

				const batteryCategoriesId = "<%= allPostTypes?.filter(item => item?.postTypeName === 'Battery Categories')[0]?._id %>";
				fetch(`/api/v1/manage/get-posts-by-post-type/${batteryCategoriesId}`)
					.then(res => res.json())
					.then(data => {
						if (data?.success) {
							const searchElement = document.createElement('div');
							searchElement.classList.add('post-link-search-container');
							searchElement.innerHTML = `<div class="searchInput">
                  <label style="width:100%;padding:5px 10px;border-bottom:1px solid rgba(0,0,0,0.3)">Search for posts</label>
                  <input type="text" placeholder="Search posts here...">
                  <div class="resultBox">
                  <!-- here list are inserted from javascript -->
                  </div>
                  <div class="icon"><i class="fas fa-search"></i></div>
               </div>`;

							const selectorDropDown = document.createElement('div');
							selectorDropDown.id = 'selector_equipment'
							selectorDropDown.style.display = 'flex';
							selectorDropDown.style.flexWrap = 'wrap';
							selectorDropDown.style.overflowY = 'scroll';
							selectorDropDown.style.height = '300px';
							selectorDropDown.style.padding = '10px';
							selectorDropDown.style.gap = '10px';

							
							const postsSelect = document.createElement('select');
							const postsSelectLabel = document.createElement('label');
							postsSelectLabel.setAttribute('for', 'linkingPostSelect');
							postsSelectLabel.textContent = 'Choose A Battery Category';
							postsSelectLabel.style.marginBottom = '15px';

							postsSelect.style.width = "100%";
							postsSelect.style.padding = "5px 10px";
							postsSelect.style.backgroundColor = "#2271b11a";
							postsSelect.style.marginBottom = "5px";
							postsSelect.id = "linkingPostSelect";
							postsSelect.setAttribute("name", "itemValue");
							data?.posts.forEach((post) => {
								const option = document.createElement('option');
								option.value = post._id;
								option.text = post.postName;
								postsSelect.appendChild(option);
							});

							// get Equipments here:
							fetch("/api/v1/manage/get-equipments")
								.then(res => res.json())
								.then(data => {
									data?.data?.forEach(item => {
										if(!item.brandName ) return;
										const brandedDiv = document.createElement("div");
										brandedDiv.style.paddingTop = '20px';
										brandedDiv.style.paddingBottom = '20px';
										brandedDiv.style.borderBottom = "1px solid rgba(0,0,0,0.45)";
										brandedDiv.style.display = 'flex';
										brandedDiv.style.flexWrap = 'wrap';
										brandedDiv.style.width = '100%';

										let menuLabel = `<p style="font-size:14px; font-weight:500; text-transform:uppercase;">${item?.brandName}</p>`;
										const menuContentParent = document.createElement('div');
										menuContentParent.style.display = 'flex';
										menuContentParent.style.flexWrap = 'wrap';
										menuContentParent.style.width = '100%';
										menuContentParent.style.gap = '10px';

										let menuContent = ``;
										item?.equipments?.forEach(equipment => {
											menuContent += `<div onclick="addEquipment(this, '${equipment._id}')" style="transition: all 300ms ease; cursor:pointer; padding:5px 10px;border-left:6px solid #d4d4d4;font-size:14px;font-weight:500; box-shadow:2px 2px 6px 1px rgba(0,0,0,0.13)">${equipment?.equipmentName}</div>`
										});
										brandedDiv.insertAdjacentHTML('beforeend', menuLabel);
										menuContentParent.insertAdjacentHTML('beforeend', menuContent);
										brandedDiv.appendChild(menuContentParent);

										const elem = document.getElementById("spec-post-linking-container");
										elem.innerHTML = '';
										elem.appendChild(postsSelectLabel);
										elem.appendChild(postsSelect);
										elem.appendChild(selectorDropDown);
										const ddd = document.getElementById('selector_equipment');
										console.log(ddd);
										ddd.appendChild(brandedDiv);
									});
								});
					}});
			} else {
				document.getElementById("arrayItemModal").style.display = "block";
			}
		}

		function addEquipment(elem, equipmentId) {
			if(equipmentArrayGlb?.indexOf(equipmentId) !== -1){
				equipmentArrayGlb = equipmentArrayGlb.filter(item => item !== equipmentId);
				elem.style.borderColor = "#d4d4d4";
			} else {
				equipmentArrayGlb.push(equipmentId);
				elem.style.borderColor = "#ff7637";
			}
			console.log(equipmentArrayGlb);
		}


		function closeArrayItemModal() {
			document.getElementById("arrayItemModal").style.display = "none"
		}

		function choosePostType(elem) {
			console.log('choosing post type', elem.value);
			fetch(`/api/v1/manage/get-posts-by-post-type/${elem.value}`)
				.then(res => res.json())
				.then(data => {
					if (data?.success) {
						const searchElement = document.createElement('div');
						searchElement.classList.add('post-link-search-container');
						searchElement.innerHTML = `<div class="searchInput">
						<label style="width:100%;padding:5px 10px;border-bottom:1px solid rgba(0,0,0,0.3)">Search for posts</label>
						<input type="text" placeholder="Search posts here...">
						<div class="resultBox">
						<!-- here list are inserted from javascript -->
						</div>
						<div class="icon"><i class="fas fa-search"></i></div>
					</div>`;
						const postsSelect = document.createElement('select');
						const postsSelectLabel = document.createElement('label');
						postsSelectLabel.setAttribute('for', 'linkingPostSelect');
						postsSelectLabel.textContent = 'Choose a post to link';
						postsSelectLabel.style.marginBottom = '15px'

						postsSelect.style.width = "100%";
						postsSelect.style.padding = "5px 10px";
						postsSelect.style.backgroundColor = "#2271b11a";
						postsSelect.style.marginBottom = "5px";
						postsSelect.id = "linkingPostSelect";
						postsSelect.setAttribute("name", "itemValue");
						data?.posts.forEach((post) => {
							const option = document.createElement('option');
							option.value = post._id; // Set the value based on your post structure
							option.text = post.postName; // Set the text based on your post structure
							postsSelect.appendChild(option);
						});
						const elem = document.getElementById("post-linking-container");
						elem.innerHTML = '';
						elem.appendChild(postsSelectLabel);
						elem.appendChild(postsSelect);
						elem.appendChild(searchElement);
						const searchInput = document.querySelector(".searchInput");
						const input = searchInput.querySelector("input");
						const resultBox = searchInput.querySelector(".resultBox");
						const icon = searchInput.querySelector(".icon");
						let linkTag = searchInput.querySelector("a");
						let webLink;
						// if user press any key and release
						input.onkeyup = (e) => {
							let userData = e.target.value; //user enetered data
							let emptyArray = [];
							if (userData) {
								emptyArray = data?.posts.filter((data) => {
									//filtering array value and user characters to lowercase and return only those words which are start with user enetered chars
									return data?.postName?.toLocaleLowerCase().startsWith(userData.toLocaleLowerCase());
								});
								emptyArray = emptyArray.map((data) => {
									// passing return data inside li tag
									return data = '<li style="color:#2271b1;">' + data?.postName + '&nbsp;<strong style="color:#000;">(' + data?._id + ')</strong>' + '</li>';
								});
								searchInput.classList.add("active"); //show autocomplete box

								showSuggestions(emptyArray, resultBox);
								let allList = resultBox.querySelectorAll("li");
								for (let i = 0; i < allList.length; i++) {
									//adding onclick attribute in all li tag
									allList[i].setAttribute("onclick", "chooseSearchedPost(this)");
								}
							} else {
								searchInput.classList.remove("active"); //hide autocomplete box
							}
						}
					}
				})
		}
		// given a modal where a user chooses a certain value using the select element. if the valus of the option chosen in "image" or "postlink", i want to open another modal that has all the posts / images in different boxes, and i can select multiple such images/posts and the image name or post name of all the selected boxes is stored in an array. when i finally press ok button and close the second modal the selected values should get displayed in the first modal. I need to do this in my express server's ejs file using js, html, and, if required, any other external library

		function chooseSearchedPost(elem) {
			console.log(elem.textContent);
			let inputString = elem.textContent;
			const regex = /\(([^)]+)\)/;
			const matchResult = inputString.match(regex);
			const extractedId = matchResult && matchResult[1];
			document.getElementById('linkingPostSelect').value = extractedId;
			const searchInput = document.querySelector(".searchInput");
			searchInput.classList.remove("active");
			const input = searchInput.querySelector("input");
			input.value = inputString;
		}

		function showSuggestions(list, resultBox) {
			let listData;
			listData = list.join('');
			resultBox.innerHTML = listData;
		}

		function chooseItemType() {
			console.log("Choosing item type...")
			const select = document.getElementById("itemType");
			const clear = document.getElementById("new-item-container");
			if (clear) {
				const parentElement = clear.parentNode;
				parentElement.removeChild(clear);
			}
			if (select.value === "") {
				const parent = document.getElementById("item-modal-content");
				parent.removeChild(document.getElementById("new-item-container"));
				arrayItemNamePointer = "";
				document.getElementById("arrayItemNamePointer").value = arrayItemNamePointer;
				return;
			} else {
				if (select.value === "String") {
					console.log('selected value is a string');
					const htmlText = `
					<label class="mb-3" for="elementName">ITEM CONTENT:</label>
					<input name="itemValue" style="width: 100%;display: block;" type="text">`;
					const elem = document.getElementById("add-item-last-btn");
					const newElement = document.createElement("div");
					newElement.id = 'new-item-container'
					newElement.innerHTML = htmlText;
					elem.parentNode.insertBefore(newElement, elem);
					document.getElementById("arrayItemNamePointer").value = arrayItemNamePointer;
				} else if (select.value === "PostLink") {
					document.getElementById("chosenLinkingPostType").style.display = "inline"
					document.getElementById("arrayItemNamePointer").value = arrayItemNamePointer;
				} else if (select.value === "Textarea") {
					const htmlText = `
					<label class="mb-3" for="elementName">ITEM CONTENT:</label>
					<textarea id="array-item-textarea" style="width: 100%;display: block;" rows="8" cols="50"  name="itemValue" type="text"></textarea>`;
					const elem = document.getElementById("add-item-last-btn");
					const newElement = document.createElement("div");
					newElement.id = 'new-item-container'
					newElement.innerHTML = htmlText;
					elem.parentNode.insertBefore(newElement, elem);
					document.getElementById("arrayItemNamePointer").value = arrayItemNamePointer;
				} else if (select.value === "JSON") {
					const htmlText = `
					<label class="mb-3" for="elementName">JSON DATA:</label>
					<textarea id="array-item-textarea" style="width: 100%;display: block;" rows="8" cols="50" type="text" name="itemValue"></textarea>`;
					const elem = document.getElementById("add-item-last-btn");
					const newElement = document.createElement("div");
					newElement.id = 'new-item-container'
					newElement.innerHTML = htmlText;
					elem.parentNode.insertBefore(newElement, elem);
					document.getElementById("arrayItemNamePointer").value = arrayItemNamePointer;
				} else if (select.value === "Image") {
					const htmlText = `
					<label class="mb-3" for="elementName">ITEM CONTENT:</label>
					<input name="itemValue" style="width: 100%;display: block;" type="file">`;
					const elem = document.getElementById("add-item-last-btn");
					const newElement = document.createElement("div");
					newElement.id = 'new-item-container';
					newElement.innerHTML = htmlText;
					elem.parentNode.insertBefore(newElement, elem);
					document.getElementById("arrayItemNamePointer").value = arrayItemNamePointer;
				}
			}
		}

		function handlemultifileinput(event) {
			console.log("handle multi file input called...");
			const files = event.target.files;
			const fileListDiv = document.getElementById("fileList");
			for (let i = 0; i < files.length; i++) {
				const file = files[i];
				const fileItem = document.createElement("div");
				fileItem.textContent = file.name;
				const removeButton = document.createElement("button");
				removeButton.textContent = "Remove";
				removeButton.onclick = function () {
					removeFile(fileItem, i);
				};
				fileItem.appendChild(removeButton);
				fileListDiv.appendChild(fileItem);
			}
		}

		function removeFile(fileItem, index) {
			const fileListDiv = document.getElementById("fileList");
			fileListDiv.removeChild(fileItem);
		}

		function handlesubmit() {
			console.log("handle submit function called...");
			let data = {};
			const formData = new FormData();
			const inputContainer = document.getElementById("inputs-container");
			const postName = inputContainer.querySelector("input[name='postName']").value;
			const modelName = inputContainer.querySelector("input[name='modelName']").value;
			const allInputs = inputContainer.querySelectorAll('input:not([name="modelName"]):not([name="postName"]):not([type="file"])');
			const allFiles = inputContainer.querySelectorAll('input[type="file"]:not([multiple])');

			allFiles.forEach(fileInput => {
				if (fileInput.files.length > 0) {
					formData.append('files', fileInput.files[0]);
					data[fileInput.getAttribute('name')] = fileInput.files[0].name
				}
			})

			allInputs.forEach(input => {
				const itemName = input.name;
				const inputValue = input.value;
				data[itemName] = inputValue;
			});

			formData.append("postName", postName);
			formData.append("modelName", modelName);

			for (var instanceName in CKEDITOR.instances) {
				if (CKEDITOR.instances.hasOwnProperty(instanceName)) {
					var editor = CKEDITOR.instances[instanceName];
					var editorContent = editor.getData();
					data[editor.textareaName] = editorContent;
				}
			}
			formData.append("postData", JSON.stringify(data));
			fetch("/api/v1/manage/add-post-data", {
				method: "POST",
				body: formData
			}).then(res => res.json()).then(data => {
				if (data.success) {
					window.location.href = `/api/v1/manage/render-post?postname=${encodeURIComponent(postName)}`;
				} else {
					console.error("Submission failed:", data.message);
				}
			});
		}
	</script>
</div>